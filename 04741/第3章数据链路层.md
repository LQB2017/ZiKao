## 使用点对点信道的数据链路层

## 数据链路和帧

链路：一个节点到相邻节点的一段物理线路。

数据链路：物理线路包含通信协议来控制数据传输。

## 三个基本问题

封装成帧：

在一段数据的前后分别添加首部和尾部。帧定界（确定帧的界限），数据部分长度上限-最大传输单元MTU。

透明传输：

“透明” 某一个实际存在的事物看起来却好像不存在一样。帧定界冲突可以使用“字节填充”。

差错检测：

“比特差错” 传输过程可能会产生差错，1变0或0变1。“误码率” 传输错误的比特占总比特的比率。“循环冗余检测CRC” 传输数据添加冗余码（帧检验序列FCS），一般可以用二进制的模2运算，如果传输过程无差错，那么经过CRC检验后得出的余数肯定是0。其他差错更复杂，例如：帧丢失、帧重复或帧失序。

# 点对点协议PPP

## PPP协议特点

PPP协议应满足的需求

1. 简单
2. 封装成帧
3. 透明性
4. 多种网络层协议
5. 多种类型链路
6. 差错检测
7. 检测连接状态
8. 最大传送单元
9. 网络层地址协商
10. 数据压缩协商

PPP协议的组成

1. 一个将IP数据报封装到串行链路的方法。
2. 一个用来建立、配置和测试数据链路连接的链路控制协议。
3. 一套网络控制协议NCP，其中每个协议支持不同的网络协议。

## PPP协议的帧格式

各字段的意义：

- PPP帧的首部和尾部分别为四个字段和两个字段
- 首部第一个字段和尾部第二个字段都是标识符F（Flag），规定为0x7E，标志字段表示一个帧的开始或结束。因此标志字段就是PPP帧的定界符。
- 首部第二个字段规定为0xFF
- 首部第三个字段规定为0x03
- 首部第四个字段是2个字节的协议字段。0x0021：IP数据报、0xC021:PPP链路控制协议LCP的数据、0x8021：网络的控制数据
- 尾部第一个字段是使用CRC的帧检验序列FCS

字节填充

信息字段和标志字段冲突处理

1. 把信息字段中出现的每一个0x7E变成为2字节序列（0x7D，0x5E）。
2. 若信息字段中出现一个0x7D的字节，则把0x7D转变为2字节序列（0x7D，0x5D）
3. 若信息字段出现ASCII码的控制字段，则在该字符前面要加入一个0x7D字段，同时将该编码加以改变。
4. 接受端在收到数据后再进行与发送端字节填充相反的变换，就可以正确地恢复出原来的信息。

零比特填充

- PPP协议用在SONET/SDH链路时，使用同步传输而不是异步传输。PPP协议采用零比特填充方法来实现透明传输。
- 在发送端先扫描整个信息字段。只要发现有5个连续1，则立即填入一个0。
- 接受端在收到一个帧时，先找到标志字段F以确定一个帧的边界，每当发现5个连续1时，就把这5个连续1后的一个零删除。

## PPP协议的工作状态



- 用户

使用广播信道的数据链路层

扩展的以太网

高速以太网